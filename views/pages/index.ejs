<html>
  <head>
      <% include ../partials/head %>
  </head>
  <body id="home-menu">
    <div id="app">
      <div class="container header">
        <div class="row">
          <div class="col-xs12">
            <h1>Drink.io</h1>
          </div>
        </div>
      </div>


      <div class="container">
        <div class="row">
          <div class="col-xs-12">
            <button v-on:click="modalType = 'create'" type="button" class="btn btn-primary menu-buttons" data-toggle="modal" data-target="#roomModal">Create Party</button>
          </div>
          <div class="col-xs-12">
            <button v-on:click="modalType = 'join'" type="button" class="btn btn-primary menu-buttons" data-toggle="modal" data-target="#roomModal" >Join Party</button>
          </div>
        </div>
      </div>


     <div class="modal fade" id="roomModal" role="dialog">
       <div class="modal-dialog modal-lg">
         <div class="modal-content">
           <div class="modal-header">
             <button type="button" class="close" data-dismiss="modal">&times;</button>
             <h4 class="modal-title">Please Enter the name of the party room you wish to {{ modalType }}.</h4>
           </div>
           <div class="modal-body">
             <input v-model="partyName" placeholder="edit me">
           </div>
           <div class="modal-footer">
              <button type="button" v-on:click="enterParty()" class="btn btn-default">{{ modalType }} Party</button>
           </div>
         </div>
       </div>
     </div>


  </div> <!--End of vue app-->


    <script>
    var socket = io();


    socket.on("error_message",function(error_message){
      console.log("Error" , error_message);
    })

    socket.on("created_party",function(success){
      window.location.href = "/party/"+app.partyName;
    });
    socket.on("joined_party",function(success){
      window.location.href = "/party/"+app.partyName;
    });



    var app = new Vue({
      el: '#app',
      data: {
        partyName: "",
        modalType: ""
      },

      methods: {
        cleanRoomName: function(partyName){
          //Remove special characters
          partyName = partyName.replace(/[^a-zA-Z ]/g, "").replace(/\s/g, '');;
          return partyName;
        },
        enterParty: function(){
          //'/party/' + cleanRoomName(partyName)
          if(this.modalType == "join"){//Join a party with a code
            socket.emit("join_party",this.partyName);
          }else{//create a party with a name
            socket.emit("create_party",this.partyName);
          }
        }
      }
    })

    </script>



  </body>
</html>
